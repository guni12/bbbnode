(window.webpackJsonpreactbbb=window.webpackJsonpreactbbb||[]).push([[5],{494:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return v}));var n=a(22),r=a(23),o=a(26),s=a(24),l=a(25),c=a(0),i=a.n(c),u=(a(50),a(445)),m=a.n(u),h=a(291),d="http://"+window.location.hostname+":1337",p=d+"/today",f=d+"/today2",g=d+"/controls",y=d+"/roomssensors/1",b=d+"/settings",v=function(e){function t(){var e;return Object(n.a)(this,t),(e=Object(o.a)(this,Object(s.a)(t).call(this)))._isMounted=!1,e.updateSec=function(){e.setState({time:new Date})},e.makeChartJson=function(e,t,a){return{id:t,color:a,data:e.filter((function(e){return null!==e})).map((function(e,t){return{x:t<9?"0".concat(t+1):"".concat(t+1),y:e}}))}},e.myformatter=function(e){var t=(parseFloat(e)/10).toFixed(1);return t=(t=t.toString()).replace(".",","),""===e&&(t=null),t},e.extractPrices=function(t){for(var a=[],n=["N\xe4r"],r=1;r<25;r++){var o="Hour"+r,s=r<10?"0"+r:r+"",l=0;3===r&&((l=""===t[o="Hour"+r+"A"]?null:(parseFloat(t[o])/10).toFixed(1))&&(a.push(l),n.push(s)),o="Hour"+r+"B",s="VT"),(l=""===t[o]?null:(parseFloat(t[o])/10).toFixed(1))&&(a.push(l),n.push(s))}return e.setState({hours:n}),a},e.handlePrices=function(e){for(var t=[],a=0;a<e.length;a++){var n=null===e[a]?e[a]:e[a].toString();n=null===n?n:n.replace(".",","),t.push(n)}return t},e.MyResponsiveLine=function(t){console.log("chdata",t);var a=i.a.createElement(h.a,{data:t,margin:{top:50,right:5,bottom:50,left:35},xScale:{type:"point"},yScale:{type:"linear",min:0,max:"auto"},axisTop:null,axisRight:null,axisBottom:{tickSize:3,tickPadding:3,tickRotation:0,legend:"Spotpriser",legendOffset:35,legendPosition:"start"},axisLeft:{orient:"left",tickSize:3,tickPadding:3,tickRotation:0,legend:e.state.currency,legendOffset:-30,legendPosition:"end"},colors:{scheme:"set1"},pointSize:5,pointColor:{from:"color",modifiers:[]},pointBorderWidth:2,pointBorderColor:{from:"color"},pointLabel:"y",pointLabelYOffset:60,enableSlices:"x",legends:[{anchor:"top-left",direction:"row",justify:!1,translateX:10,translateY:-40,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:10,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .9)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .08)",itemOpacity:1}}]}]});e.setState({chart:a})},e.state={pricenow:"0",currency:"\xf6re/kwh",hour:"0",name:"",average:"0",tempis:"0",measured:"0",should:"0",percent:"0",today:"",tomorrow:"",hours:[],prices:[],controls:[],tomspot:[],chart:null,chartdata:null,time:new Date},e}return Object(l.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;console.log(window.location,this.props.location,this.props.location.pathname),this._isMounted=!0;var t=this.state.time,a=t.getHours(),n=t.getDate(),r=t.getDate()+1,o=t.getMonth()+1,s=n+"/"+o,l=r+"/"+o,c=t.getMinutes();console.log("52",a,c),fetch(y).then((function(e){return e.json()})).then((function(t){if(e._isMounted){console.log("roomssensors",t[0]);var a=t[0].tempis.toFixed(1),n=a||"Kommer visa \xe4rv\xe4rde";return e.setState({measured:t[0].measured}),e.setState({tempis:n}),e.setState({should:t[0].should}),e.setState({name:t[0].roomname}),fetch(p)}})).then((function(e){return e.json()})).then((function(t){if(e._isMounted){var n="Hour"+a,r="EUR"===t.Currency?"c/kwh":"\xf6re/kwh",o=e.myformatter(t.Average),c=e.myformatter(t[n]),i=e.extractPrices(t),u=e.handlePrices(i),m=e.makeChartJson(i,"idag","hsl(12,100%,46%)");return e.setState({average:o}),e.setState({pricenow:c}),e.setState({hour:a}),e.setState({currency:r}),e.setState({today:s}),e.setState({tomorrow:l}),e.setState({prices:u}),e.setState({chartdata:m}),e.MyResponsiveLine([e.state.chartdata]),fetch(g)}})).then((function(e){return console.log("results2",e),e.json()})).then((function(t){return console.log("data2",t),e.setState({controls:t}),a>=16&&c>=3?fetch(f).then((function(e){return e.json()})).then((function(t){var a=e.extractPrices(t),n=e.handlePrices(a),r=e.state.chartdata,o=e.makeChartJson(a,"imorgon","orange"),s=[];return r&&s.push(r),o&&s.push(o),e.setState({tomspot:n}),e.MyResponsiveLine(s),fetch(b)})):fetch(b)})).then((function(e){return console.log(e),e.json()})).then((function(t){e.setState({percent:t.percent})})).catch((function(e){if(console.log(e),"AbortError"!==e.name)throw e})),setInterval(this.updateSec,1e3)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this.state.prices,t=this.state.controls,a=this.state.hours,n=this.state.percent,r=null,o=null,s=this.state.time,l=s.getHours(),c=s.getMinutes(),u=s.getSeconds();return this.state.hour>16&&(r=i.a.createElement("td",null,this.state.tomorrow),o=this.state.tomspot.map((function(e,t){return i.a.createElement("td",{key:t},e)}))),i.a.createElement("div",{className:"hub-page"},i.a.createElement("p",null,l,":",c<10?"0"+c:c,":",u<10?"0"+u:u," ",i.a.createElement("span",{className:"red-small larger-font"},this.state.pricenow," "),this.state.currency,i.a.createElement("br",null),"Medelpris ",i.a.createElement("span",{className:"red-small larger-font avg"},this.state.average)," ",i.a.createElement("span",{className:"currency"},this.state.currency),i.a.createElement("br",null),this.state.header,i.a.createElement("br",null),i.a.createElement("span",{className:"zonename"},this.state.name)," ",i.a.createElement("span",{className:"red-small larger-font hubtempis"},this.state.tempis)," \xb0C",i.a.createElement("br",null),"Du \xf6nskar ",i.a.createElement("span",{className:"red-small larger-font hubshould"},this.state.should)," \xb0C",i.a.createElement("br",null),"Uppm\xe4tt: ",this.state.measured),i.a.createElement(m.a,{striped:!0,bordered:!0,hover:!0,size:"sm",responsive:!0,className:"mytable"},i.a.createElement("thead",null,i.a.createElement("tr",null,a.map((function(e,t){return i.a.createElement("th",{key:t},e)})))),i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,this.state.today),e.map((function(e,t){return i.a.createElement("td",{key:t},e)}))),i.a.createElement("tr",{className:"control"},i.a.createElement("td",null,n+"%"),t.map((function(e,t){return i.a.createElement("td",{key:t,className:"class"+e})}))),i.a.createElement("tr",null,r,o))),i.a.createElement("div",{className:"chart"},this.state.chart))}}]),t}(c.Component)}}]);
//# sourceMappingURL=5.81cc7155.chunk.js.map